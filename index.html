<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lotomania - Jogos Estratégicos</title>
<style>
html, body {height:100%;margin:0;padding:0;font-family:Arial,sans-serif;color:white;text-align:center;overflow-x:hidden;}
body {background-image:url('./img/cyborg.jpg');background-size:cover;background-position:center;background-repeat:no-repeat;background-attachment:fixed;padding:21px;}
#buttons {margin-bottom: 21px;}
button {padding:10px 15px;margin:5px;font-size:14px;cursor:pointer;border-radius:20px;}
.tabela-container {display:flex;justify-content:center;margin:20px auto;}
#tabela {display:none;background:rgba(0,0,0,0.9);padding:15px;border-radius:12px;flex-direction:column;gap:5px;}
.linha-tabela {display:flex;justify-content:flex-start;align-items:center;gap:5px;}
.label-tabela {width:20px;font-weight:bold;text-align:center;}
.ball-tabela {width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:black;border:2px solid transparent;}
.line-A .ball-tabela {background:#FFA500;color:black;}
.line-B .ball-tabela {background:#FFD700;color:black;}
.line-C .ball-tabela {background:#90EE90;color:black;}
.line-D .ball-tabela {background:#00FA9A;color:black;}
.line-E .ball-tabela {background:#32CD32;color:black;}
.line-F .ball-tabela {background:#ADFF2F;color:black;}
.line-G .ball-tabela {background:#FF4500;color:white;}
.line-H .ball-tabela {background:#800080;color:white;}
#container {display:flex;flex-direction:column;align-items:center;}
.bloco {display:flex;flex-wrap:wrap;gap:20px;justify-content:center;margin-bottom:20px;width:100%;}
.jogo {display:flex;flex-direction:column;gap:5px;border:2px solid #5ac48d;padding:10px;border-radius:8px;background:rgba(0,0,0,0.7);}
.linha {display:flex;gap:3px;align-items:center;}
.label {width:20px;text-align:center;font-weight:bold;margin-right:5px;}
.ball {width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;border:2px solid transparent;transition: all 0.3s;}
.ball.acerto {border:2px solid #32FF00;animation: glowGreen 1s infinite alternate;}
@keyframes glowGreen {from {box-shadow: 0 0 5px #32FF00;} to {box-shadow: 0 0 20px #32FF00;}}
.line-A .ball {background:#FFA500;color:black;}
.line-B .ball {background:#FFD700;color:black;}
.line-C .ball {background:#90EE90;color:black;}
.line-D .ball {background:#00FA9A;color:black;}
.line-E .ball {background:#32CD32;color:black;}
.line-F .ball {background:#ADFF2F;color:black;}
.line-G .ball {background:#FF4500;color:white;}
.line-H .ball {background:#800080;color:white;}

#numeroContainerWrapper {display:flex;flex-direction:column;align-items:center;margin-bottom:20px;width:100%;}
#numeroContainerWrapper div:first-child {margin-bottom:10px;font-weight:bold;font-size:16px;}
#numeroContainer {display:flex;justify-content:center;flex-wrap:wrap;max-width:700px;gap:10px;background:rgba(0,0,0,0.5);padding:10px;border-radius:12px;}
.numero {width:40px;height:40px;border:2px solid white;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:text;user-select:none;background:rgba(0,0,0,0.2);color:white;font-weight:bold;text-align:center;font-size:16px;transition: all 0.3s;}
.numero.preenchido {border:2px solid #32FF00;animation: glowGreen 1s infinite alternate;}
</style>
</head>
<body>

<div id="buttons">
  <button id="btnGenerate">Gerar Tabela</button>
  <button id="btnClear">Limpar</button>
  <button id="btnComb">Gerar 56 Jogos</button>
  <button id="btnToggleTabela">Mostrar Tabela</button>
  <button id="btnSave">Salvar Jogos</button>
  <button id="btnLoad">Carregar Jogos</button>
</div>

<div id="numeroContainerWrapper">
  <div>Digite o último resultado</div>
  <div id="numeroContainer"></div>
</div>

<div class="tabela-container">
  <div id="tabela"></div>
</div>
<div id="container"></div>

<script>
const letras=["A","B","C","D","E","F","G","H"];
let tabelaNumeros={};
let ultimoResultado=Array(20).fill(null);

function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
}

function gerarCombinacoes(array,k){
  let results=[];
  function aux(start, comb){
    if(comb.length===k){ results.push([...comb]); return; }
    for(let i=start;i<array.length;i++){
      comb.push(array[i]);
      aux(i+1, comb);
      comb.pop();
    }
  }
  aux(0, []);
  return results;
}

function criarTabela(){
  tabelaNumeros={};
  const numeros=Array.from({length:90},(_,i)=>i+11);
  shuffleArray(numeros);
  let index=0;
  const tabelaDiv=document.getElementById("tabela");
  tabelaDiv.innerHTML="";
  tabelaDiv.style.display="flex";

  letras.forEach(letra=>{
    tabelaNumeros[letra]=[];
    const linhaDiv=document.createElement("div");
    linhaDiv.classList.add("linha-tabela",`line-${letra}`);
    const labelDiv=document.createElement("div");
    labelDiv.classList.add("label-tabela");
    labelDiv.textContent=letra;
    linhaDiv.appendChild(labelDiv);

    let numsLinha = [];
    for(let i=0;i<13;i++){
      if(index<numeros.length) numsLinha.push(numeros[index++]);
    }
    shuffleArray([11,22,33,44,55,66,77,88,99]);
    numsLinha.push(...[11,22,33,44,55,66,77,88,99].filter(n=>!numsLinha.includes(n)).slice(0,2));
    shuffleArray(numsLinha);

    tabelaNumeros[letra] = numsLinha;

    numsLinha.forEach(n=>{
      const b=document.createElement("div");
      b.classList.add("ball-tabela");
      b.textContent=n;
      linhaDiv.appendChild(b);
    });
    tabelaDiv.appendChild(linhaDiv);
  });

  document.getElementById("container").innerHTML="";
}

function criarInterfaceUltimoResultado(){
  const container=document.getElementById("numeroContainer");
  container.innerHTML="";
  ultimoResultado = Array(20).fill(null);
  for(let i=0;i<20;i++){
    const numDiv=document.createElement("div");
    numDiv.classList.add("numero");
    numDiv.contentEditable = true;
    numDiv.addEventListener("input",()=>{
      let val = parseInt(numDiv.textContent);
      if(!isNaN(val) && val>=1 && val<=100){
        ultimoResultado[i] = val;
        numDiv.classList.add("preenchido");
      } else {
        ultimoResultado[i] = null;
        numDiv.classList.remove("preenchido");
      }
      atualizarAcertos();
    });
    container.appendChild(numDiv);
  }
}

function atualizarAcertos() {
  document.querySelectorAll("#container .jogo").forEach(jogo => {
    let acertosJogo = 0;
    jogo.querySelectorAll(".linha .ball").forEach(b => {
      const num = parseInt(b.textContent);
      if (ultimoResultado.includes(num)) {
        acertosJogo++;
        b.classList.add("acerto");
      } else {
        b.classList.remove("acerto");
      }
    });
    jogo.querySelectorAll("div").forEach(d => {
      if(d.textContent.startsWith("Acertos:")) d.textContent = "Acertos: " + acertosJogo;
    });
  });
}

function gerar56Jogos(){
  if(!tabelaNumeros || Object.keys(tabelaNumeros).length===0){
    alert("Primeiro gere a tabela!");
    return;
  }
  const todas = gerarCombinacoes(letras,5);
  const container=document.getElementById("container");
  container.innerHTML="";
  let blocoDiv=null;

  todas.forEach((linhasJogo,i)=>{
    if(i%4===0){
      blocoDiv=document.createElement("div");
      blocoDiv.classList.add("bloco");
      container.appendChild(blocoDiv);
    }

    const jogoDiv=document.createElement("div");
    jogoDiv.classList.add("jogo");

    const numeroJogo=document.createElement("div");
    numeroJogo.style.fontWeight="bold";
    numeroJogo.style.marginBottom="5px";
    numeroJogo.style.textAlign="center";
    numeroJogo.textContent="Jogo "+(i+1);
    jogoDiv.appendChild(numeroJogo);

    const numerosUsados = new Set();
    let totalNumeros = 0;

    linhasJogo.forEach(l=>{
      const linhaDiv=document.createElement("div");
      linhaDiv.classList.add("linha",`line-${l}`);
      const labelDiv=document.createElement("div");
      labelDiv.classList.add("label");
      labelDiv.textContent=l;
      linhaDiv.appendChild(labelDiv);

      // Pega números da linha sem repetir dentro do card
      let numsDisponiveis = tabelaNumeros[l].filter(n=>!numerosUsados.has(n));
      shuffleArray(numsDisponiveis);

      while (linhaDiv.childElementCount-1 < 13 && numsDisponiveis.length > 0 && totalNumeros < 50) {
        const n = numsDisponiveis.pop();
        const b=document.createElement("div");
        b.classList.add("ball");
        b.textContent=n;
        linhaDiv.appendChild(b);
        numerosUsados.add(n);
        totalNumeros++;
      }

      jogoDiv.appendChild(linhaDiv);
    });

    // Caso faltem números para completar 50, preenche de forma aleatória de qualquer linha
    let todasLinhas = letras.flatMap(l=>tabelaNumeros[l].filter(n=>!numerosUsados.has(n)));
    shuffleArray(todasLinhas);
    while(totalNumeros < 50 && todasLinhas.length > 0){
      const n = todasLinhas.pop();
      const b=document.createElement("div");
      b.classList.add("ball");
      b.textContent=n;
      // Adiciona na última linha do card
      jogoDiv.lastChild.appendChild(b);
      numerosUsados.add(n);
      totalNumeros++;
    }

    const acertosDiv=document.createElement("div");
    acertosDiv.style.marginTop="5px";
    acertosDiv.style.fontWeight="bold";
    acertosDiv.textContent="Acertos: 0";
    jogoDiv.appendChild(acertosDiv);

    blocoDiv.appendChild(jogoDiv);
  });

  atualizarAcertos();
}

// Botões
document.getElementById("btnGenerate").addEventListener("click",()=>{
  criarTabela();
  criarInterfaceUltimoResultado();
});
document.getElementById("btnClear").addEventListener("click",()=>{
  document.getElementById("container").innerHTML="";
  document.getElementById("tabela").innerHTML="";
  document.getElementById("tabela").style.display="none";
  document.getElementById("numeroContainer").innerHTML="";
  tabelaNumeros={};
  ultimoResultado=Array(20).fill(null);
});
document.getElementById("btnComb").addEventListener("click",gerar56Jogos);
document.getElementById("btnSave").addEventListener("click",()=>{
  const jogos=Array.from(document.querySelectorAll("#container .jogo")).map(j=>j.innerHTML);
  if(jogos.length===0){alert("Não há jogos para salvar!"); return;}
  localStorage.setItem("lotomaniaJogos",JSON.stringify(jogos));
  alert("Jogos salvos!");
});
document.getElementById("btnLoad").addEventListener("click",()=>{
  const jogosSalvos=JSON.parse(localStorage.getItem("lotomaniaJogos"));
  if(!jogosSalvos||jogosSalvos.length===0){alert("Nenhum jogo salvo!"); return;}
  const container=document.getElementById("container");
  container.innerHTML="";
  let blocoDiv=document.createElement("div");
  blocoDiv.classList.add("bloco");
  container.appendChild(blocoDiv);
  jogosSalvos.forEach(html=>{
    const jogoDiv=document.createElement("div");
    jogoDiv.classList.add("jogo");
    jogoDiv.innerHTML=html;
    blocoDiv.appendChild(jogoDiv);
  });
  atualizarAcertos();
});
document.getElementById("btnToggleTabela").addEventListener("click",()=>{
  const tabelaDiv=document.getElementById("tabela");
  if(tabelaDiv.style.display==="none"||tabelaDiv.style.display===""){
    tabelaDiv.style.display="flex";
    document.getElementById("btnToggleTabela").textContent="Ocultar Tabela";
  }else{
    tabelaDiv.style.display="none";
    document.getElementById("btnToggleTabela").textContent="Mostrar Tabela";
  }
});
document.getElementById("tabela").style.display="none";
</script>
</body>
</html>
